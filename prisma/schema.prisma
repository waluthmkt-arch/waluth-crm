generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  password      String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  workspaces      WorkspaceMember[]
  ownedWorkspaces Workspace[]
  assignedTasks   TaskAssignee[]
  comments        Comment[]
  customFields    CustomField[]
}

model Workspace {
  id        String   @id @default(cuid())
  name      String
  ownerId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  owner   User              @relation(fields: [ownerId], references: [id])
  members WorkspaceMember[]
  spaces  Space[]
  tags    Tag[]
}

model WorkspaceMember {
  id          String   @id @default(cuid())
  userId      String
  workspaceId String
  role        String   @default("MEMBER") // OWNER, ADMIN, MEMBER, GUEST
  joinedAt    DateTime @default(now())

  user      User      @relation(fields: [userId], references: [id])
  workspace Workspace @relation(fields: [workspaceId], references: [id])

  @@index([userId])
  @@index([workspaceId])
}

model Space {
  id          String   @id @default(cuid())
  name        String
  icon        String?
  color       String?
  isFavorite  Boolean  @default(false)
  isArchived  Boolean  @default(false)
  workspaceId String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspace Workspace @relation(fields: [workspaceId], references: [id])
  folders   Folder[]
  lists     List[]
  statuses  Status[]

  @@index([workspaceId])
}

model Folder {
  id        String   @id @default(cuid())
  name      String
  icon      String?
  color     String?
  isFavorite Boolean  @default(false)
  isArchived Boolean  @default(false)
  spaceId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  space Space  @relation(fields: [spaceId], references: [id])
  lists List[]

  @@index([spaceId])
}

model List {
  id        String   @id @default(cuid())
  name      String
  icon      String?
  color     String?
  isFavorite Boolean  @default(false)
  isArchived Boolean  @default(false)
  spaceId   String?
  folderId  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  space  Space?  @relation(fields: [spaceId], references: [id])
  folder Folder? @relation(fields: [folderId], references: [id])
  tasks  Task[]
  statuses Status[]
  customFields CustomField[]

  @@index([spaceId])
  @@index([folderId])
}

model Task {
  id          String   @id @default(cuid())
  name        String
  description String?
  status      String?
  priority    String? // URGENT, HIGH, NORMAL, LOW, NONE
  dueDate     DateTime?
  listId      String
  parentId    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  list      List           @relation(fields: [listId], references: [id])
  parent    Task?          @relation("Subtasks", fields: [parentId], references: [id])
  subtasks  Task[]         @relation("Subtasks")
  assignees TaskAssignee[]
  tags      TaskTag[]
  comments  Comment[]
  customFieldValues CustomFieldValue[]

  @@index([listId])
  @@index([parentId])
}

model TaskAssignee {
  taskId String
  userId String

  task Task @relation(fields: [taskId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@id([taskId, userId])
  @@index([taskId])
  @@index([userId])
}

model Status {
  id        String   @id @default(cuid())
  name      String
  color     String
  icon      String?
  category  String   @default("active")
  order     Int      @default(0)
  spaceId   String?
  listId    String?

  space Space? @relation(fields: [spaceId], references: [id])
  list  List?  @relation(fields: [listId], references: [id])

  @@index([spaceId])
  @@index([listId])
}

model Tag {
  id          String @id @default(cuid())
  name        String
  color       String
  workspaceId String

  workspace Workspace @relation(fields: [workspaceId], references: [id])
  tasks     TaskTag[]

  @@index([workspaceId])
}

model TaskTag {
  taskId String
  tagId  String

  task Task @relation(fields: [taskId], references: [id])
  tag  Tag  @relation(fields: [tagId], references: [id])

  @@id([taskId, tagId])
  @@index([taskId])
  @@index([tagId])
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  taskId    String
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  task Task @relation(fields: [taskId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@index([taskId])
  @@index([userId])
}

model CustomField {
  id          String   @id @default(cuid())
  name        String
  description String?  // Field description
  type        String   // TEXT, NUMBER, DATE, SELECT, CHECKBOX, CURRENCY, RATING
  options     String?  // JSON for select options
  
  // Currency-specific
  currency    String?  // "BRL", "USD", "EUR", etc.
  
  // Configuration flags
  required    Boolean  @default(false)
  pinned      Boolean  @default(false)
  hideEmpty   Boolean  @default(false)
  
  // Visibility
  visibility  String   @default("all") // "all", "limited", "private"
  
  // Relations
  listId      String
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  list    List               @relation(fields: [listId], references: [id])
  creator User               @relation(fields: [createdBy], references: [id])
  values  CustomFieldValue[]

  @@index([listId])
  @@index([createdBy])
}

model CustomFieldValue {
  id        String   @id @default(cuid())
  taskId    String
  fieldId   String
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  task  Task        @relation(fields: [taskId], references: [id])
  field CustomField @relation(fields: [fieldId], references: [id])

  @@unique([taskId, fieldId])
  @@index([taskId])
  @@index([fieldId])
}
